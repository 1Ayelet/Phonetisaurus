<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Phonetisaurus: src/lib/M2MFstAligner.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Phonetisaurus
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">FST-based Grapheme-to-Phoneme conversion</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">M2MFstAligner.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_m2_m_fst_aligner_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> M2MFstAligner.cpp </span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> Copyright (c) [2012-], Josef Robert Novak</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> All rights reserved.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  modification, are permitted #provided that the following conditions</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">  are met:</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">  * Redistributions of source code must retain the above copyright </span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">    notice, this list of conditions and the following disclaimer.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">    * Redistributions in binary form must reproduce the above </span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">    copyright notice, this list of #conditions and the following </span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">    disclaimer in the documentation and/or other materials provided </span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">    with the distribution.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS </span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT </span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS </span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE </span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, </span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES </span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR </span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) </span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, </span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) </span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED </span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> OF THE POSSIBILITY OF SUCH DAMAGE.</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_m2_m_fst_aligner_8h.html">include/M2MFstAligner.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a914c39c27f3467848d3034a42d5d7fca">   35</a></span>&#160;M2MFstAligner::M2MFstAligner( ){</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">//Default constructor</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#ae23113e5cae29dc94b32ed9579d55c25">   39</a></span>&#160;<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a914c39c27f3467848d3034a42d5d7fca">M2MFstAligner::M2MFstAligner</a> (<span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1ea4cfa480a906720412d89e3cbdf78f">seq1_del</a>, <span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5aaa4b5b87e92d8060aa23f28e9219e6">seq2_del</a>, </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ab83262d3fb217a148435777d28dcf3bd">seq1_max</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5317b10db862b4f09b34e71b253b24c6">seq2_max</a>, </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                  <span class="keywordtype">string</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a03ce5ddbcc042ece93dc2ac0dde9935d">seq1_sep</a>, <span class="keywordtype">string</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a959c82581fc3a8a2a5999cc4daee123d">seq2_sep</a>, </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                  <span class="keywordtype">string</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a>, <span class="keywordtype">string</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#accef9f2dfd2f0c5a91ccf7c796d832cf">eps</a>, <span class="keywordtype">string</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6632333cec0394fdb012ac60b91817ce">skip</a>,</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                  <span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6bf185403bdfc4bb5302235ba06f196b">penalize</a>, <span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae2218632c2af9b8b788d36bebb7db9b7">penalize_em</a>, </div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                  <span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a11bb481204d03c4019f3fc0644da9320">restrict</a>) </div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  : seq1_del (seq1_del), seq2_del (seq2_del), seq1_max (seq1_max),</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    seq2_max (seq2_max), seq1_sep (seq1_sep), seq2_sep (seq2_sep),</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    s1s2_sep (s1s2_sep), eps (eps), skip (skip), penalize (penalize),</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    penalize_em (penalize_em), restrict (restrict) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">//Base constructor.  Determine whether or not to allow deletions in seq1 and seq2</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// as well as the maximum allowable subsequence size.</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adf30d66ed3320bb5f0d5c18a08861a3b">skipSeqs</a>.insert (0);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a> = <span class="keyword">new</span> SymbolTable(<span class="stringliteral">&quot;syms&quot;</span>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">//Add all the important symbols to the table.  We can store these </span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// in the model that we train and then attach them to the fst model</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// if we want to use it later on. </span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">//Thus, in addition to eps-&gt;0, we reserve symbol ids 1-4 as well.</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol (eps);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol (skip);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">//The &#39;_&#39; as a separator here is dangerous</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol (seq1_sep + <span class="stringliteral">&quot;_&quot;</span> + seq2_sep);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol (s1s2_sep);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">string</span> s1_del_str = seq1_del ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordtype">string</span> s2_del_str = seq2_del ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordtype">string</span> s1_max_str = <a class="code" href="util_8h.html#ad1428a7f966f4f8bf2b5f2c6a8f847b2">itoas</a> (seq1_max);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordtype">string</span> s2_max_str = <a class="code" href="util_8h.html#ad1428a7f966f4f8bf2b5f2c6a8f847b2">itoas</a> (seq2_max);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordtype">string</span> model_params = s1_del_str + <span class="stringliteral">&quot;_&quot;</span> + s2_del_str + <span class="stringliteral">&quot;_&quot;</span> \</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    + s1_max_str + <span class="stringliteral">&quot;_&quot;</span> + s2_max_str;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol (model_params);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a>     = LogWeight::Zero ();</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ac79327f76616e526a76c414c897af138">prevTotal</a> = LogWeight::Zero ();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">//penalties.set_empty_key(0);</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a013e0f95a5b4e92db0824dc96bf63b1c">   74</a></span>&#160;<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a914c39c27f3467848d3034a42d5d7fca">M2MFstAligner::M2MFstAligner</a> (<span class="keywordtype">string</span> model_file, <span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6bf185403bdfc4bb5302235ba06f196b">penalize</a>, </div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                  <span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae2218632c2af9b8b788d36bebb7db9b7">penalize_em</a>, <span class="keywordtype">bool</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a11bb481204d03c4019f3fc0644da9320">restrict</a>)</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  : penalize (penalize), penalize_em (penalize_em), restrict (restrict) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">    Initialize the aligner with a previously trained model.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">    The model requires that the first several symbols in the </span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">    symbols table contain the separator and other bookkeeping info.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="comment">//penalties.set_empty_key(0);</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  VectorFst&lt;LogArc&gt;* model = VectorFst&lt;LogArc&gt;::Read (model_file);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordflow">for</span> (StateIterator&lt;VectorFst&lt;LogArc&gt; &gt; siter (*model); </div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;       !siter.Done (); siter.Next ()) {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    LogArc::StateId q = siter.Value ();</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">for</span>( ArcIterator&lt;VectorFst&lt;LogArc&gt; &gt; aiter (*model, q); </div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;     !aiter.Done (); aiter.Next ()) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keyword">const</span> LogArc&amp; arc = aiter.Value ();</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a>.insert (pair&lt;LogArc::Label, LogWeight&gt; </div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                  (arc.ilabel,arc.weight));</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }      </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a> = (SymbolTable*)model-&gt;InputSymbols ();</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#accef9f2dfd2f0c5a91ccf7c796d832cf">eps</a>   = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find (i);<span class="comment">//Can&#39;t write &#39;0&#39; here for some reason...</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6632333cec0394fdb012ac60b91817ce">skip</a>  = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find (1);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordtype">string</span> tie = <span class="stringliteral">&quot;_&quot;</span>; <span class="comment">//tie to pack parameters</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordtype">string</span> sseps = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find (2);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  vector&lt;string&gt; seps = <a class="code" href="util_8h.html#aefb62abc53e44fa74b034b6de17fd3ba">tokenize_utf8_string</a> (&amp;sseps, &amp;tie);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a03ce5ddbcc042ece93dc2ac0dde9935d">seq1_sep</a> = seps [0];</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a959c82581fc3a8a2a5999cc4daee123d">seq2_sep</a> = seps [1];</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a> = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find (3);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordtype">string</span> sparams = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find (4);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  vector&lt;string&gt; params = <a class="code" href="util_8h.html#aefb62abc53e44fa74b034b6de17fd3ba">tokenize_utf8_string</a> (&amp;sparams, &amp;tie);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1ea4cfa480a906720412d89e3cbdf78f">seq1_del</a> = params [0].compare (<span class="stringliteral">&quot;true&quot;</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5aaa4b5b87e92d8060aa23f28e9219e6">seq2_del</a> = params [1].compare (<span class="stringliteral">&quot;true&quot;</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ab83262d3fb217a148435777d28dcf3bd">seq1_max</a> = atoi (params [2].c_str ());</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5317b10db862b4f09b34e71b253b24c6">seq2_max</a> = atoi (params [3].c_str ());</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a9da148c5847ae7e41ae46bd80f5ffb5d">  115</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9da148c5847ae7e41ae46bd80f5ffb5d">M2MFstAligner::write_model</a> (<span class="keywordtype">string</span> model_file) {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">    Write the alignment model to disk using a single-state WFSA.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  VectorFst&lt;LogArc&gt; model;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  model.AddState ();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  model.SetStart (0);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  model.SetFinal (0, LogWeight::One ());</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  map&lt;LogArc::Label,LogWeight&gt;::iterator it;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordflow">for</span> (it = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a>.begin (); it != <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a>.end (); it++)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    model.AddArc (0, LogArc( (*it).first, (*it).first, (*it).second, 0));</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  model.SetInputSymbols (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  model.Write (model_file);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a11a90035d22ec0cafb2f5129a43c7346">  134</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a11a90035d22ec0cafb2f5129a43c7346">M2MFstAligner::expectation</a> () {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">    Here we compute the arc posteriors.  This routine is almost </span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">    fun to implement in the FST paradigm.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">//omp_set_num_threads (4);</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">//#pragma omp parallel for</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.size (); i++) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">//Compute Forward and Backward probabilities</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    vector&lt;LogWeight&gt; alpha, beta;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    ShortestDistance (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.at (i), &amp;alpha);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    ShortestDistance (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.at (i), &amp;beta, <span class="keyword">true</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">//Compute the normalized Gamma probabilities and </span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// update our running tally</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">for</span> (StateIterator&lt;VectorFst&lt;LogArc&gt; &gt; siter (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.at (i)); </div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;     !siter.Done (); siter.Next ()) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keyword">const</span> LogArc::StateId q = siter.Value ();</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordflow">for</span> (ArcIterator&lt;VectorFst&lt;LogArc&gt; &gt; aiter (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.at (i), q); </div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;       !aiter.Done (); aiter.Next ()) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">const</span> LogArc&amp;      arc = aiter.Value ();</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">const</span> LogWeight&amp; gamma = Divide (Times (Times (alpha [q], arc.weight), </div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        beta [arc.nextstate]), beta [0]);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">//Check for any BadValue results, otherwise add to the tally.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">//We call this &#39;prev_alignment_model&#39; which may seem misleading, but</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// this conventions leads to &#39;alignment_model&#39; being the final version.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">if</span> (gamma.Value () == gamma.Value ()) {</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a> [arc.ilabel] = \</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        Plus (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a> [arc.ilabel], gamma);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a> = Plus (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a>, gamma);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    alpha.clear ();</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    beta.clear ();</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a0b3cc458129b1af2ffda2dfda3247339">  173</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a0b3cc458129b1af2ffda2dfda3247339">M2MFstAligner::_conditional_max</a> (<span class="keywordtype">bool</span> y_given_x) {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">    Compute the conditional distribution, P(Y|X) using the WFST paradigm.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">    This is bassed on the approach from Shu and Hetherington 2002.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">    It is assumed that all WFSTs and operations use the Log semiring.</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">    Given: </span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">           FST1 = P(X,Y)</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">    Compute:</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">           FST2 = P(X) </span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">             := Map_inv(Det(RmEps(Proj_i(FST1))))</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">           FST3 = P(Y|X)</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">             := Compose(FST2,FST1)</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">    Proj_i:  project on input labels</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">    RmEps:   epsilon removal</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">    Det:     determinize</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">    Map_inv: invert weights</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">    Notes: An analogous process may be used to compute P(X|Y).  In this</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">      case one would project on OUTPUT labels - Proj_o, and reverse the</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">      composition order to Compose(FST1,FST2).</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">    Future work:</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">      What we are doing here in terms of *generating* the JOINT fst each</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">      time is really just a dumb hack.  We *should* encode the model in an</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">      FST and encode the individual lattices, rather than doing the hacky</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">      manual label encoding that we currently rely on.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="comment">//Joint distribution that we start with</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  VectorFst&lt;LogArc&gt;* joint  = <span class="keyword">new</span> VectorFst&lt;LogArc&gt;();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  SymbolTable* misyms = <span class="keyword">new</span> SymbolTable(<span class="stringliteral">&quot;misyms&quot;</span>);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  SymbolTable* mosyms = <span class="keyword">new</span> SymbolTable(<span class="stringliteral">&quot;mosyms&quot;</span>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  joint-&gt;AddState();</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  joint-&gt;AddState();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  joint-&gt;SetStart(0);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  joint-&gt;SetFinal(1,LogArc::Weight::One());</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  map&lt;LogArc::Label,LogWeight&gt;::iterator it;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">for</span>( it=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>.begin(); it != <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>.end(); it++ ){</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordtype">string</span> isym = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find((*it).first); </div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    vector&lt;string&gt; io = <a class="code" href="util_8h.html#aefb62abc53e44fa74b034b6de17fd3ba">tokenize_utf8_string</a>( &amp;isym, &amp;<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a> );</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    LogArc arc( misyms-&gt;AddSymbol(io[0]), mosyms-&gt;AddSymbol(io[1]), (*it).second, 1 );</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    joint-&gt;AddArc( 0, arc );</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">//VectorFst&lt;LogArc&gt;* joint  = new VectorFst&lt;LogArc&gt;();</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">//Push&lt;LogArc,REWEIGHT_TO_FINAL&gt;(*_joint, joint, kPushWeights);</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">//joint-&gt;SetFinal(1,LogWeight::One());</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  joint-&gt;Write(<span class="stringliteral">&quot;m2mjoint.fst&quot;</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">//BEGIN COMPUTE MARGINAL P(X)  </span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  VectorFst&lt;LogArc&gt;* dmarg;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">if</span>( y_given_x )</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    dmarg = <span class="keyword">new</span> VectorFst&lt;LogArc&gt;(ProjectFst&lt;LogArc&gt;(*joint, PROJECT_INPUT));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    dmarg = <span class="keyword">new</span> VectorFst&lt;LogArc&gt;(ProjectFst&lt;LogArc&gt;(*joint, PROJECT_OUTPUT));</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  RmEpsilon(dmarg);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  VectorFst&lt;LogArc&gt;* marg = <span class="keyword">new</span> VectorFst&lt;LogArc&gt;();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  Determinize(*dmarg, marg);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  ArcMap(marg, InvertWeightMapper&lt;LogArc&gt;());</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <span class="keywordflow">if</span>( y_given_x )</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    ArcSort(marg, OLabelCompare&lt;LogArc&gt;());</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    ArcSort(marg, ILabelCompare&lt;LogArc&gt;());</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="comment">//END COMPUTE MARGINAL P(X)</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  marg-&gt;Write(<span class="stringliteral">&quot;marg.fst&quot;</span>);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">//CONDITIONAL P(Y|X)</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  VectorFst&lt;LogArc&gt;* cond = <span class="keyword">new</span> VectorFst&lt;LogArc&gt;();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">if</span>( y_given_x )</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    Compose(*marg, *joint, cond);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    Compose(*joint, *marg, cond);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">//cond now contains the conditional distribution P(Y|X)</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  cond-&gt;Write(<span class="stringliteral">&quot;cond.fst&quot;</span>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="comment">//Now update the model with the new values</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">for</span>( MutableArcIterator&lt;VectorFst&lt;LogArc&gt; &gt; aiter(cond, 0); !aiter.Done(); aiter.Next() ){</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    LogArc arc = aiter.Value();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordtype">string</span> lab = misyms-&gt;Find(arc.ilabel)+<span class="stringliteral">&quot;}&quot;</span>+mosyms-&gt;Find(arc.olabel);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordtype">int</span> labi   = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find(lab);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a>[labi]      = arc.weight;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>[labi] = LogWeight::Zero();</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keyword">delete</span> joint;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keyword">delete</span> marg;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keyword">delete</span> cond;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keyword">delete</span> dmarg;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keyword">delete</span> misyms;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keyword">delete</span> mosyms;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    </div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a34e2870052782eb77c63453cb0ce0a59">  268</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a34e2870052782eb77c63453cb0ce0a59">M2MFstAligner::maximization</a> (<span class="keywordtype">bool</span> lastiter) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">//Maximization. Standard approach is simple count normalization.  </span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">//The &#39;penalize&#39; option penalizes links by total length.  Results seem to be inconclusive.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">//  Probably get an improvement by distinguishing between gaps and insertions, etc.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordtype">bool</span> cond = <span class="keyword">false</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordtype">float</span> change = abs (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a>.Value () - <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ac79327f76616e526a76c414c897af138">prevTotal</a>.Value ());</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">if</span> (cond == <span class="keyword">false</span>) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    map&lt;LogArc::Label,LogWeight&gt;::iterator it;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Total: &quot; &lt;&lt; total &lt;&lt; &quot; Change: &quot; &lt;&lt; abs(total.Value()-prevTotal.Value()) &lt;&lt; endl;</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ac79327f76616e526a76c414c897af138">prevTotal</a> = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">//Normalize and iterate to the next model.  We apply it dynamically </span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// during the expectation step.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">for</span> (it = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>.begin ();</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;     it != <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>.end (); it++) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a> [(*it).first] = Divide ((*it).second, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      (*it).second = LogWeight::Zero ();</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a0b3cc458129b1af2ffda2dfda3247339">_conditional_max</a> (<span class="keyword">true</span>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.size(); i++) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">for</span> (StateIterator&lt;VectorFst&lt;LogArc&gt; &gt; siter (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a> [i]); </div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;     !siter.Done (); siter.Next ()) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      LogArc::StateId q = siter.Value ();</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">for</span> (MutableArcIterator&lt;VectorFst&lt;LogArc&gt; &gt; aiter (&amp;<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a> [i], q); </div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;       !aiter.Done (); aiter.Next ()) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    LogArc arc = aiter.Value ();</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae2218632c2af9b8b788d36bebb7db9b7">penalize_em</a> == <span class="keyword">true</span>) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="struct_label_datum.html">LabelDatum</a>* ld = &amp;<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a68f61c95a194c87e16e1e62c87181fef">penalties</a> [arc.ilabel];</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">if</span> (ld-&gt;<a class="code" href="struct_label_datum.html#ac735b1257d3ac02397d5d00504ac3c49">lhs</a> &gt; 1 &amp;&amp; ld-&gt;<a class="code" href="struct_label_datum.html#a78490546433503593378e5a51d25357d">rhs</a> &gt; 1) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        arc.weight = 99; </div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ld-&gt;<a class="code" href="struct_label_datum.html#a090f9cb87d5c86357e8541cfa5734987">lhsE</a> == <span class="keyword">false</span> &amp;&amp; ld-&gt;<a class="code" href="struct_label_datum.html#a3c8e06212069ae651190dbacaf51c293">rhsE</a> == <span class="keyword">false</span>) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        arc.weight = arc.weight.Value () * ld-&gt;<a class="code" href="struct_label_datum.html#a2a1456e3ecb8e615959b17d9592e4fdd">tot</a>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">        else{</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">        arc.weight = arc.weight.Value() * (ld-&gt;tot+10);</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">if</span> (arc.weight == LogWeight::Zero () || arc.weight != arc.weight)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        arc.weight = 99;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      arc.weight = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a> [arc.ilabel];</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    aiter.SetValue (arc);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a> = LogWeight::Zero ();</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordflow">return</span> change;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;}</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a1db289de9291e452e50ee2b49bab837d">  325</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1db289de9291e452e50ee2b49bab837d">M2MFstAligner::Sequences2FST</a> (VectorFst&lt;LogArc&gt;* <a class="code" href="namespacefst.html">fst</a>, vector&lt;string&gt;* seq1, vector&lt;string&gt;* seq2 ){</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">    Build an FST that represents all possible alignments between seq1 and seq2, given the </span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">     parameter values input by the user.  Here we encode the input and output labels, in fact</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">     creating a WFSA.  This simplifies the training process, but means that we can only </span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">     easily compute a joint maximization.  In practice joint maximization seems to give the </span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">     best results anyway, so it probably doesn&#39;t matter.</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">    Note: this also performs the initizization routine.  It performs a UNIFORM initialization</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">     meaning that every non-null alignment sequence is eventually initialized to 1/Num(unique_alignments).</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">     It might be more appropriate to consider subsequence length here, but for now we stick </span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">     to the m2m-aligner approach.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">    TODO: Add an FST version and support for conditional maximization.  May be useful for languages</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">     like Japanese where there is a distinct imbalance in the seq1-&gt;seq2 length correspondences.</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordtype">int</span> istate=0; <span class="keywordtype">int</span> ostate=0;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;=seq1-&gt;size(); i++ ){</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;=seq2-&gt;size(); j++ ){</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      fst-&gt;AddState();</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      istate = i*(seq2-&gt;size()+1)+j;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="comment">//Epsilon arcs for seq1</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1ea4cfa480a906720412d89e3cbdf78f">seq1_del</a>==<span class="keyword">true</span> )</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=1; l&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5317b10db862b4f09b34e71b253b24c6">seq2_max</a>; l++ ){</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">if</span>( j+l&lt;=seq2-&gt;size() ){</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        vector&lt;string&gt; subseq2( seq2-&gt;begin()+j, seq2-&gt;begin()+j+l );</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keywordtype">int</span> is = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol(<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6632333cec0394fdb012ac60b91817ce">skip</a>+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a>+<a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq2, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a959c82581fc3a8a2a5999cc4daee123d">seq2_sep</a>));</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        ostate = i*(seq2-&gt;size()+1) + (j+l);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        LogArc arc( is, is, 99, ostate );</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        fst-&gt;AddArc( istate, arc );</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">        if( prev_alignment_model.find(arc.ilabel)==prev_alignment_model.end() ){</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">          prev_alignment_model.insert( pair&lt;LogArc::Label,LogWeight&gt;(arc.ilabel,arc.weight) );</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">          _compute_penalties( arc.ilabel, 1, l, true, false );</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">        }else{</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">          prev_alignment_model[arc.ilabel] = Plus(prev_alignment_model[arc.ilabel],arc.weight);</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">        total = Plus( total, arc.weight );</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="comment">//Epsilon arcs for seq2</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5aaa4b5b87e92d8060aa23f28e9219e6">seq2_del</a>==<span class="keyword">true</span> )</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=1; k&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ab83262d3fb217a148435777d28dcf3bd">seq1_max</a>; k++ ){</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordflow">if</span>( i+k&lt;=seq1-&gt;size() ){</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        vector&lt;string&gt; subseq1( seq1-&gt;begin()+i, seq1-&gt;begin()+i+k );</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordtype">int</span> is = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol(<a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq1, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a03ce5ddbcc042ece93dc2ac0dde9935d">seq1_sep</a>)+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a>+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6632333cec0394fdb012ac60b91817ce">skip</a>);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        ostate = (i+k)*(seq2-&gt;size()+1) + j;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        LogArc arc( is, is, 99, ostate );</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        fst-&gt;AddArc( istate, arc );</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">        if( prev_alignment_model.find(arc.ilabel)==prev_alignment_model.end() ){</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">          prev_alignment_model.insert( pair&lt;LogArc::Label,LogWeight&gt;(arc.ilabel,arc.weight) );</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">          _compute_penalties( arc.ilabel, k, 1, false, true );</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">        }else{</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">          prev_alignment_model[arc.ilabel] = Plus(prev_alignment_model[arc.ilabel],arc.weight);</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">        total = Plus(total, arc.weight);</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <span class="comment">//All the other arcs</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=1; k&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ab83262d3fb217a148435777d28dcf3bd">seq1_max</a>; k++ ){</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=1; l&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5317b10db862b4f09b34e71b253b24c6">seq2_max</a>; l++ ){</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keywordflow">if</span>( i+k&lt;=seq1-&gt;size() &amp;&amp; j+l&lt;=seq2-&gt;size() ){</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        vector&lt;string&gt; subseq1( seq1-&gt;begin()+i, seq1-&gt;begin()+i+k );</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordtype">string</span> s1 = <a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq1, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a03ce5ddbcc042ece93dc2ac0dde9935d">seq1_sep</a>);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        vector&lt;string&gt; subseq2( seq2-&gt;begin()+j, seq2-&gt;begin()+j+l );</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordtype">string</span> s2 = <a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq2, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a959c82581fc3a8a2a5999cc4daee123d">seq2_sep</a>);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment">//This says only 1-M and N-1 allowed, no M-N links!</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a11bb481204d03c4019f3fc0644da9320">restrict</a>==<span class="keyword">true</span> &amp;&amp; l&gt;1 &amp;&amp; k&gt;1)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordtype">int</span> is = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;AddSymbol(s1+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a>+s2);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        ostate = (i+k)*(seq2-&gt;size()+1) + (j+l);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        LogArc arc( is, is, LogWeight::One().Value()*(k+l), ostate );</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        fst-&gt;AddArc( istate, arc );</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="comment">//During the initialization phase, just count non-eps transitions</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment">//We currently initialize to uniform probability so there is also </span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="comment">// no need to tally anything here.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">        if( prev_alignment_model.find(arc.ilabel)==prev_alignment_model.end() ){</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">          prev_alignment_model.insert( pair&lt;LogArc::Label,LogWeight&gt;(arc.ilabel, arc.weight) );</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">          _compute_penalties( arc.ilabel, k, l, false, false );</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">        }else{</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">          prev_alignment_model[arc.ilabel] = Plus(prev_alignment_model[arc.ilabel],arc.weight);</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">        total = Plus( total, arc.weight );</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">        */</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  fst-&gt;SetStart(0);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  fst-&gt;SetFinal( ((seq1-&gt;size()+1)*(seq2-&gt;size()+1))-1, LogWeight::One() );</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="comment">//Unless seq1_del==true &amp;&amp; seq2_del==true we will have unconnected states</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">// thus we need to run connect to clean out these states</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1ea4cfa480a906720412d89e3cbdf78f">seq1_del</a>==<span class="keyword">false</span> || <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5aaa4b5b87e92d8060aa23f28e9219e6">seq2_del</a>==<span class="keyword">false</span> )</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    Connect(fst);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="comment">//Only add arcs that are in the FINAL fst to the model</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordflow">for</span>( StateIterator&lt;VectorFst&lt;LogArc&gt; &gt; siter(*fst); !siter.Done(); siter.Next() ){</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    LogArc::StateId q = siter.Value();</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordflow">for</span>( ArcIterator&lt;VectorFst&lt;LogArc&gt; &gt; aiter(*fst, q); !aiter.Done(); aiter.Next() ){</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="keyword">const</span> LogArc&amp; arc = aiter.Value();</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>.find(arc.ilabel)==<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>.end() ){</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>.insert( pair&lt;LogArc::Label,LogWeight&gt;(arc.ilabel, arc.weight) );</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordtype">string</span> sym = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find(arc.ilabel);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordtype">size_t</span> del = sym.find(<span class="stringliteral">&quot;}&quot;</span>);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordtype">size_t</span> chu = sym.find(<span class="stringliteral">&quot;|&quot;</span>);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">int</span> k=1; <span class="keywordtype">int</span> l=1;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">if</span>( chu!=string::npos ){</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keywordflow">if</span>( chu&lt;del )</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        k += 1;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        l += 1;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#aa4b94a3f28c9d09f4616aa670869e762">_compute_penalties</a>( arc.ilabel, k, l, <span class="keyword">false</span>, <span class="keyword">false</span> );</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>[arc.ilabel] = Plus(<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">prev_alignment_model</a>[arc.ilabel],arc.weight);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a> = Plus( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">total</a>, arc.weight );</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">if</span>( seq1-&gt;size()&gt;5 &amp;&amp; seq1-&gt;at(0)==<span class="stringliteral">&quot;a&quot;</span> &amp;&amp; seq1-&gt;at(1)==<span class="stringliteral">&quot;s&quot;</span> &amp;&amp; seq1-&gt;at(2)==<span class="stringliteral">&quot;b&quot;</span> ){</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    fst-&gt;SetInputSymbols(<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    fst-&gt;Write(<span class="stringliteral">&quot;asbestos.fst&quot;</span>);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;}</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a81d549823f9f06ced0fadf7ab097a8e3">  463</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a81d549823f9f06ced0fadf7ab097a8e3">M2MFstAligner::Sequences2FSTNoInit</a>( VectorFst&lt;LogArc&gt;* <a class="code" href="namespacefst.html">fst</a>, vector&lt;string&gt;* seq1, vector&lt;string&gt;* seq2 ){</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">    Build an FST that represents all possible alignments between seq1 and seq2, given the </span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">     parameter values input by the user.  Here we encode the input and output labels, in fact</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">     creating a WFSA.  This simplifies the training process, but means that we can only </span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">     easily compute a joint maximization.  In practice joint maximization seems to give the </span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">     best results anyway, so it probably doesn&#39;t matter.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keywordtype">int</span> istate=0; <span class="keywordtype">int</span> ostate=0;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;=seq1-&gt;size(); i++ ){</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;=seq2-&gt;size(); j++ ){</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      fst-&gt;AddState();</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      istate = i*(seq2-&gt;size()+1)+j;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">//Epsilon arcs for seq1</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1ea4cfa480a906720412d89e3cbdf78f">seq1_del</a>==<span class="keyword">true</span> )</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=1; l&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5317b10db862b4f09b34e71b253b24c6">seq2_max</a>; l++ ){</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">if</span>( j+l&lt;=seq2-&gt;size() ){</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        vector&lt;string&gt; subseq2( seq2-&gt;begin()+j, seq2-&gt;begin()+j+l );</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordtype">int</span> is = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find(<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6632333cec0394fdb012ac60b91817ce">skip</a>+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a>+<a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq2, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a959c82581fc3a8a2a5999cc4daee123d">seq2_sep</a>));</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        ostate = i*(seq2-&gt;size()+1) + (j+l);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        LogArc arc( is, is, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a>[is], ostate );</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#aa4b94a3f28c9d09f4616aa670869e762">_compute_penalties</a>( arc.ilabel, 1, l, <span class="keyword">true</span>, <span class="keyword">false</span> );</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        fst-&gt;AddArc( istate, arc );</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    }</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="comment">//Epsilon arcs for seq2</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5aaa4b5b87e92d8060aa23f28e9219e6">seq2_del</a>==<span class="keyword">true</span> )</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=1; k&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ab83262d3fb217a148435777d28dcf3bd">seq1_max</a>; k++ ){</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">if</span>( i+k&lt;=seq1-&gt;size() ){</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        vector&lt;string&gt; subseq1( seq1-&gt;begin()+i, seq1-&gt;begin()+i+k );</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordtype">int</span> is = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find(<a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq1, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a03ce5ddbcc042ece93dc2ac0dde9935d">seq1_sep</a>)+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a>+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a6632333cec0394fdb012ac60b91817ce">skip</a>);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        ostate = (i+k)*(seq2-&gt;size()+1) + j;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        LogArc arc( is, is, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a>[is], ostate );</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#aa4b94a3f28c9d09f4616aa670869e762">_compute_penalties</a>( arc.ilabel, k, 1, <span class="keyword">false</span>, <span class="keyword">true</span> );</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        fst-&gt;AddArc( istate, arc );</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      }</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="comment">//All the other arcs</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=1; k&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ab83262d3fb217a148435777d28dcf3bd">seq1_max</a>; k++ ){</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l=1; l&lt;=<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5317b10db862b4f09b34e71b253b24c6">seq2_max</a>; l++ ){</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">if</span>( i+k&lt;=seq1-&gt;size() &amp;&amp; j+l&lt;=seq2-&gt;size() ){</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        vector&lt;string&gt; subseq1( seq1-&gt;begin()+i, seq1-&gt;begin()+i+k );</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordtype">string</span> s1 = <a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq1, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a03ce5ddbcc042ece93dc2ac0dde9935d">seq1_sep</a>);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        vector&lt;string&gt; subseq2( seq2-&gt;begin()+j, seq2-&gt;begin()+j+l );</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordtype">string</span> s2 = <a class="code" href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a>(subseq2, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a959c82581fc3a8a2a5999cc4daee123d">seq2_sep</a>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a11bb481204d03c4019f3fc0644da9320">restrict</a>==<span class="keyword">true</span> &amp;&amp; l&gt;1 &amp;&amp; k&gt;1)</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keywordtype">int</span> is = <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">isyms</a>-&gt;Find(s1+<a class="code" href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">s1s2_sep</a>+s2);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        ostate = (i+k)*(seq2-&gt;size()+1) + (j+l);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        LogArc arc( is, is, <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">alignment_model</a>[is], ostate );</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#aa4b94a3f28c9d09f4616aa670869e762">_compute_penalties</a>( arc.ilabel, k, l, <span class="keyword">false</span>, <span class="keyword">false</span> );</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        fst-&gt;AddArc( istate, arc );</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      }</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  fst-&gt;SetStart(0);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  fst-&gt;SetFinal( ((seq1-&gt;size()+1)*(seq2-&gt;size()+1))-1, LogWeight::One() );</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">//Unless seq1_del==true &amp;&amp; seq2_del==true we will have unconnected states</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">// thus we need to run connect to clean out these states</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="keywordflow">if</span>( <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1ea4cfa480a906720412d89e3cbdf78f">seq1_del</a>==<span class="keyword">false</span> || <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a5aaa4b5b87e92d8060aa23f28e9219e6">seq2_del</a>==<span class="keyword">false</span> )</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    Connect(fst);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;}</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">//Build the composed alignment FST and add it to the list of training data</span></div><div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a626abb1ec3fa645300b81878b3f622e1">  535</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a626abb1ec3fa645300b81878b3f622e1">M2MFstAligner::entry2alignfst</a>( vector&lt;string&gt; seq1, vector&lt;string&gt; seq2 ){</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  VectorFst&lt;LogArc&gt; <a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a1db289de9291e452e50ee2b49bab837d">Sequences2FST</a>( &amp;fst, &amp;seq1, &amp;seq2 );</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.push_back(fst);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;}</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#a2bbe32f59993d307dea9225ea38eb545">  542</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a2bbe32f59993d307dea9225ea38eb545">M2MFstAligner::entry2alignfstnoinit</a>( vector&lt;string&gt; seq1, vector&lt;string&gt; seq2, <span class="keywordtype">int</span> nbest, <span class="keywordtype">string</span> lattice ){</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">    There is a pre-trained alignment model, so just use the model parameters to weight the alignment arcs.</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">    This could probably be merged with &quot;entry2alignfst()&quot;, but we&#39;ll leave it for now.</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  VectorFst&lt;LogArc&gt; <a class="code" href="namespacefst.html">fst</a>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a81d549823f9f06ced0fadf7ab097a8e3">Sequences2FSTNoInit</a>( &amp;fst, &amp;seq1, &amp;seq2 );</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fsas</a>.push_back(fst);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;}</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno"><a class="line" href="classfst_1_1_m2_m_fst_aligner.html#aa4b94a3f28c9d09f4616aa670869e762">  553</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#aa4b94a3f28c9d09f4616aa670869e762">M2MFstAligner::_compute_penalties</a>( LogArc::Label label, <span class="keywordtype">int</span> lhs, <span class="keywordtype">int</span> rhs, <span class="keywordtype">bool</span> lhsE, <span class="keywordtype">bool</span> rhsE ){</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">    Precompute exponential penalties for all possible alignment units.</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  <a class="code" href="struct_label_datum.html">LabelDatum</a> ld;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  ld.<a class="code" href="struct_label_datum.html#ac735b1257d3ac02397d5d00504ac3c49">lhs</a>  = lhs;   ld.<a class="code" href="struct_label_datum.html#a78490546433503593378e5a51d25357d">rhs</a> = rhs;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  ld.<a class="code" href="struct_label_datum.html#a090f9cb87d5c86357e8541cfa5734987">lhsE</a> = lhsE; ld.<a class="code" href="struct_label_datum.html#a3c8e06212069ae651190dbacaf51c293">rhsE</a> = rhsE;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  ld.<a class="code" href="struct_label_datum.html#ad12ade588686bd305fd6db8fb2bf65b3">max</a>  = max(lhs, rhs);  </div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  ld.<a class="code" href="struct_label_datum.html#a2a1456e3ecb8e615959b17d9592e4fdd">tot</a>  = lhs + rhs;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <a class="code" href="classfst_1_1_m2_m_fst_aligner.html#a68f61c95a194c87e16e1e62c87181fef">penalties</a>.insert( LabelData::value_type( label, ld ) );</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;}</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a11a90035d22ec0cafb2f5129a43c7346"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a11a90035d22ec0cafb2f5129a43c7346">fst::M2MFstAligner::expectation</a></div><div class="ttdeci">void expectation()</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00134">M2MFstAligner.cc:134</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a914c39c27f3467848d3034a42d5d7fca"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a914c39c27f3467848d3034a42d5d7fca">fst::M2MFstAligner::M2MFstAligner</a></div><div class="ttdeci">M2MFstAligner()</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00035">M2MFstAligner.cc:35</a></div></div>
<div class="ttc" id="struct_label_datum_html"><div class="ttname"><a href="struct_label_datum.html">LabelDatum</a></div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00041">util.h:41</a></div></div>
<div class="ttc" id="_m2_m_fst_aligner_8h_html"><div class="ttname"><a href="_m2_m_fst_aligner_8h.html">M2MFstAligner.h</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a28eef199b821dbf9a30c4e5e0c2f91f5"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a28eef199b821dbf9a30c4e5e0c2f91f5">fst::M2MFstAligner::alignment_model</a></div><div class="ttdeci">map&lt; LogArc::Label, LogWeight &gt; alignment_model</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00086">M2MFstAligner.h:86</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_adf30d66ed3320bb5f0d5c18a08861a3b"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#adf30d66ed3320bb5f0d5c18a08861a3b">fst::M2MFstAligner::skipSeqs</a></div><div class="ttdeci">set&lt; int &gt; skipSeqs</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00076">M2MFstAligner.h:76</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a1ea4cfa480a906720412d89e3cbdf78f"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a1ea4cfa480a906720412d89e3cbdf78f">fst::M2MFstAligner::seq1_del</a></div><div class="ttdeci">bool seq1_del</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00062">M2MFstAligner.h:62</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a5317b10db862b4f09b34e71b253b24c6"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a5317b10db862b4f09b34e71b253b24c6">fst::M2MFstAligner::seq2_max</a></div><div class="ttdeci">unsigned int seq2_max</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00065">M2MFstAligner.h:65</a></div></div>
<div class="ttc" id="namespacefst_html"><div class="ttname"><a href="namespacefst.html">fst</a></div><div class="ttdef"><b>Definition:</b> <a href="_lattice_pruner_8h_source.html#l00037">LatticePruner.h:37</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_ac79327f76616e526a76c414c897af138"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#ac79327f76616e526a76c414c897af138">fst::M2MFstAligner::prevTotal</a></div><div class="ttdeci">LogWeight prevTotal</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00090">M2MFstAligner.h:90</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a959c82581fc3a8a2a5999cc4daee123d"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a959c82581fc3a8a2a5999cc4daee123d">fst::M2MFstAligner::seq2_sep</a></div><div class="ttdeci">string seq2_sep</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00067">M2MFstAligner.h:67</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a81d549823f9f06ced0fadf7ab097a8e3"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a81d549823f9f06ced0fadf7ab097a8e3">fst::M2MFstAligner::Sequences2FSTNoInit</a></div><div class="ttdeci">void Sequences2FSTNoInit(VectorFst&lt; LogArc &gt; *fst, vector&lt; string &gt; *seq1, vector&lt; string &gt; *seq2)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00463">M2MFstAligner.cc:463</a></div></div>
<div class="ttc" id="util_8h_html_ad1428a7f966f4f8bf2b5f2c6a8f847b2"><div class="ttname"><a href="util_8h.html#ad1428a7f966f4f8bf2b5f2c6a8f847b2">itoas</a></div><div class="ttdeci">string itoas(int i)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cc_source.html#l00044">util.cc:44</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a6bf185403bdfc4bb5302235ba06f196b"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a6bf185403bdfc4bb5302235ba06f196b">fst::M2MFstAligner::penalize</a></div><div class="ttdeci">bool penalize</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00071">M2MFstAligner.h:71</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a11bb481204d03c4019f3fc0644da9320"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a11bb481204d03c4019f3fc0644da9320">fst::M2MFstAligner::restrict</a></div><div class="ttdeci">bool restrict</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00073">M2MFstAligner.h:73</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_adfa1cb33010886b0f58955d4ad5572cd"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#adfa1cb33010886b0f58955d4ad5572cd">fst::M2MFstAligner::fsas</a></div><div class="ttdeci">vector&lt; VectorFst&lt; LogArc &gt; &gt; fsas</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00079">M2MFstAligner.h:79</a></div></div>
<div class="ttc" id="util_8h_html_a260903f8b736572053601a2667f700d1"><div class="ttname"><a href="util_8h.html#a260903f8b736572053601a2667f700d1">vec2str</a></div><div class="ttdeci">string vec2str(vector&lt; string &gt; vec, string sep)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cc_source.html#l00034">util.cc:34</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a68f61c95a194c87e16e1e62c87181fef"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a68f61c95a194c87e16e1e62c87181fef">fst::M2MFstAligner::penalties</a></div><div class="ttdeci">LabelData penalties</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00088">M2MFstAligner.h:88</a></div></div>
<div class="ttc" id="struct_label_datum_html_a3c8e06212069ae651190dbacaf51c293"><div class="ttname"><a href="struct_label_datum.html#a3c8e06212069ae651190dbacaf51c293">LabelDatum::rhsE</a></div><div class="ttdeci">bool rhsE</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00041">util.h:41</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_abddceb68231f6724bf69f358f678c94d"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#abddceb68231f6724bf69f358f678c94d">fst::M2MFstAligner::total</a></div><div class="ttdeci">LogWeight total</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00089">M2MFstAligner.h:89</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_aa4b94a3f28c9d09f4616aa670869e762"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#aa4b94a3f28c9d09f4616aa670869e762">fst::M2MFstAligner::_compute_penalties</a></div><div class="ttdeci">void _compute_penalties(LogArc::Label label, int lhs, int rhs, bool lhsE, bool rhsE)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00553">M2MFstAligner.cc:553</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a34e2870052782eb77c63453cb0ce0a59"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a34e2870052782eb77c63453cb0ce0a59">fst::M2MFstAligner::maximization</a></div><div class="ttdeci">float maximization(bool lastiter)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00268">M2MFstAligner.cc:268</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a1db289de9291e452e50ee2b49bab837d"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a1db289de9291e452e50ee2b49bab837d">fst::M2MFstAligner::Sequences2FST</a></div><div class="ttdeci">void Sequences2FST(VectorFst&lt; LogArc &gt; *fst, vector&lt; string &gt; *seq1, vector&lt; string &gt; *seq2)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00325">M2MFstAligner.cc:325</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_ae495dc0a0762485ad6b797bfe656cf53"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#ae495dc0a0762485ad6b797bfe656cf53">fst::M2MFstAligner::s1s2_sep</a></div><div class="ttdeci">string s1s2_sep</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00068">M2MFstAligner.h:68</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a9a259b679800a82cca3822f6abaa0e60"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a9a259b679800a82cca3822f6abaa0e60">fst::M2MFstAligner::isyms</a></div><div class="ttdeci">SymbolTable * isyms</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00085">M2MFstAligner.h:85</a></div></div>
<div class="ttc" id="struct_label_datum_html_ad12ade588686bd305fd6db8fb2bf65b3"><div class="ttname"><a href="struct_label_datum.html#ad12ade588686bd305fd6db8fb2bf65b3">LabelDatum::max</a></div><div class="ttdeci">int max</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00041">util.h:41</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_accef9f2dfd2f0c5a91ccf7c796d832cf"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#accef9f2dfd2f0c5a91ccf7c796d832cf">fst::M2MFstAligner::eps</a></div><div class="ttdeci">string eps</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00069">M2MFstAligner.h:69</a></div></div>
<div class="ttc" id="struct_label_datum_html_a2a1456e3ecb8e615959b17d9592e4fdd"><div class="ttname"><a href="struct_label_datum.html#a2a1456e3ecb8e615959b17d9592e4fdd">LabelDatum::tot</a></div><div class="ttdeci">int tot</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00041">util.h:41</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a03ce5ddbcc042ece93dc2ac0dde9935d"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a03ce5ddbcc042ece93dc2ac0dde9935d">fst::M2MFstAligner::seq1_sep</a></div><div class="ttdeci">string seq1_sep</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00066">M2MFstAligner.h:66</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_ae2218632c2af9b8b788d36bebb7db9b7"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#ae2218632c2af9b8b788d36bebb7db9b7">fst::M2MFstAligner::penalize_em</a></div><div class="ttdeci">bool penalize_em</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00072">M2MFstAligner.h:72</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a5aaa4b5b87e92d8060aa23f28e9219e6"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a5aaa4b5b87e92d8060aa23f28e9219e6">fst::M2MFstAligner::seq2_del</a></div><div class="ttdeci">bool seq2_del</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00063">M2MFstAligner.h:63</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a2bbe32f59993d307dea9225ea38eb545"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a2bbe32f59993d307dea9225ea38eb545">fst::M2MFstAligner::entry2alignfstnoinit</a></div><div class="ttdeci">void entry2alignfstnoinit(vector&lt; string &gt; seq1, vector&lt; string &gt; seq2, int nbest, string lattice=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00542">M2MFstAligner.cc:542</a></div></div>
<div class="ttc" id="struct_label_datum_html_ac735b1257d3ac02397d5d00504ac3c49"><div class="ttname"><a href="struct_label_datum.html#ac735b1257d3ac02397d5d00504ac3c49">LabelDatum::lhs</a></div><div class="ttdeci">int lhs</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00041">util.h:41</a></div></div>
<div class="ttc" id="struct_label_datum_html_a78490546433503593378e5a51d25357d"><div class="ttname"><a href="struct_label_datum.html#a78490546433503593378e5a51d25357d">LabelDatum::rhs</a></div><div class="ttdeci">int rhs</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00041">util.h:41</a></div></div>
<div class="ttc" id="util_8h_html_aefb62abc53e44fa74b034b6de17fd3ba"><div class="ttname"><a href="util_8h.html#aefb62abc53e44fa74b034b6de17fd3ba">tokenize_utf8_string</a></div><div class="ttdeci">vector&lt; string &gt; tokenize_utf8_string(string *utf8_string, string *delimiter)</div><div class="ttdef"><b>Definition:</b> <a href="util_8cc_source.html#l00050">util.cc:50</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a626abb1ec3fa645300b81878b3f622e1"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a626abb1ec3fa645300b81878b3f622e1">fst::M2MFstAligner::entry2alignfst</a></div><div class="ttdeci">void entry2alignfst(vector&lt; string &gt; seq1, vector&lt; string &gt; seq2)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00535">M2MFstAligner.cc:535</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a0b3cc458129b1af2ffda2dfda3247339"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a0b3cc458129b1af2ffda2dfda3247339">fst::M2MFstAligner::_conditional_max</a></div><div class="ttdeci">void _conditional_max(bool x_given_y)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00173">M2MFstAligner.cc:173</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a9da148c5847ae7e41ae46bd80f5ffb5d"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a9da148c5847ae7e41ae46bd80f5ffb5d">fst::M2MFstAligner::write_model</a></div><div class="ttdeci">void write_model(string model_name)</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8cc_source.html#l00115">M2MFstAligner.cc:115</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_ab83262d3fb217a148435777d28dcf3bd"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#ab83262d3fb217a148435777d28dcf3bd">fst::M2MFstAligner::seq1_max</a></div><div class="ttdeci">unsigned int seq1_max</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00064">M2MFstAligner.h:64</a></div></div>
<div class="ttc" id="struct_label_datum_html_a090f9cb87d5c86357e8541cfa5734987"><div class="ttname"><a href="struct_label_datum.html#a090f9cb87d5c86357e8541cfa5734987">LabelDatum::lhsE</a></div><div class="ttdeci">bool lhsE</div><div class="ttdef"><b>Definition:</b> <a href="util_8h_source.html#l00041">util.h:41</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_abbfbf7af9e7ed78f02dc11b3573fcafa"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#abbfbf7af9e7ed78f02dc11b3573fcafa">fst::M2MFstAligner::prev_alignment_model</a></div><div class="ttdeci">map&lt; LogArc::Label, LogWeight &gt; prev_alignment_model</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00087">M2MFstAligner.h:87</a></div></div>
<div class="ttc" id="classfst_1_1_m2_m_fst_aligner_html_a6632333cec0394fdb012ac60b91817ce"><div class="ttname"><a href="classfst_1_1_m2_m_fst_aligner.html#a6632333cec0394fdb012ac60b91817ce">fst::M2MFstAligner::skip</a></div><div class="ttdeci">string skip</div><div class="ttdef"><b>Definition:</b> <a href="_m2_m_fst_aligner_8h_source.html#l00070">M2MFstAligner.h:70</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
